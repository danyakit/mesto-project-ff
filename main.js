(()=>{"use strict";function e(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input-error"),n.classList.remove("popup__input-error_active"),n.textContent=""}function t(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_disabled")):(t.disabled=!0,t.classList.add("popup__button_disabled"))}var n,o,r,c,u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"02a29a47-c4b8-4283-90ff-394df3316f4b","Content-Type":"application/json"}},a=function(e){return fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},i=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},p=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},s=document.querySelector(".places__list"),l=document.querySelector(".popup_type_edit .popup__form"),d=document.querySelector(".popup_type_new-card .popup__form"),_=document.querySelector(".edit__avatar .popup__form"),f=document.querySelector(".popup__input_type_name"),m=document.querySelector(".popup__input_type_description"),y=document.querySelector(".popup__input_type_card-name"),v=document.querySelector(".popup__input_type_url"),h=document.querySelector(".popup__input_type_url-avatar"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_image"),g=(S.querySelector(".popup__close"),q.querySelector(".popup__close"),b.querySelector(".popup__close"),b.querySelector(".popup__image")),k=b.querySelector(".popup__caption"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.querySelector(".edit__avatar");function j(e){e.currentTarget.querySelector(".popup__content").contains(e.target)||P(e.currentTarget)}function x(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&P(t)}}function A(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),1),e.addEventListener("click",j),document.addEventListener("keydown",x)}function P(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",j),document.removeEventListener("keydown",x)}function T(e,t,n,o,r){var c=document.getElementById("card-template"),u=document.importNode(c.content,!0).querySelector(".card");u.dataset.cardId=e._id;var a=u.querySelector(".card__title"),i=u.querySelector(".card__image"),p=u.querySelector(".card__like-count");a.textContent=e.name,i.src=e.link,i.alt=e.name,p.textContent=e.likes.length;var s=u.querySelector(".card__delete-button");return r?s.addEventListener("click",(function(){t(u,e._id)})):s.style.display="none",u.querySelector(".card__like-button").addEventListener("click",(function(t){n(t,p,e._id)})),i.addEventListener("click",o),u}function U(e,t){a(t).then((function(){e.remove()})).catch((function(e){console.error(e)}))}function D(e,t,n){e.target.classList.contains("card__like-button_is-active")?p(n).then((function(n){w(e.target,t,n.likes.length)})).catch((function(e){console.log(e)})):i(n).then((function(n){w(e.target,t,n.likes.length)})).catch((function(e){console.log(e)}))}function w(e,t,n){e.classList.toggle("card__like-button_is-active"),t.textContent=n}function O(e){var t,n,o=e.target;o.classList.contains("card__image")&&(t=o.src,n=o.alt,g.src=t,g.alt=n,k.textContent=n,A(b))}function I(e){e.forEach((function(e){var t=T(e,U,D,O,!1);s.appendChild(t)}))}l.addEventListener("submit",(function(e){e.preventDefault();var t,n=f.value,o=m.value,r=l.querySelector(".popup__button");r.textContent="Сохранение...",(t={name:n,about:o},fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){L.textContent=e.name,E.textContent=e.about,P(q),l.reset()})).catch((function(e){console.log(e)})).finally((function(){r.textContent="Сохранить"}))})),d.addEventListener("submit",(function(e){e.preventDefault();var n,o={name:y.value,link:v.value},r=d.querySelector(".popup__button");r.textContent="Сохранение...",(n=o,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var n=T(e,U,D,O,!0);s.prepend(n),P(S),d.reset(),t(Array.from(d.querySelectorAll(".popup__input")),d.querySelector(".popup__button"))})).catch((function(e){console.error(e)})).finally((function(){r.textContent="Сохранить"}))})),_.addEventListener("submit",(function(e){e.preventDefault();var t=h.value,n=_.querySelector(".popup__button");n.textContent="Сохранение...",function(e){return fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){console.log("Аватар успешно обновлен:",e),document.querySelector(".profile__image").style.backgroundImage="url(".concat(t,")"),P(C),_.reset()})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)})).finally((function(){n.textContent="Сохранить"}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){A(S)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){A(q),f.value=L.textContent,m.value=E.textContent,t(Array.from(l.querySelectorAll(".popup__input")),l.querySelector(".popup__button"))})),document.querySelector(".profile__image").addEventListener("click",(function(){A(C)})),document.querySelectorAll(".popup__close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return P(t)}))})),n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(n.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(n){var o=Array.from(n.querySelectorAll(".popup__input")),r=n.querySelector(".popup__button");t(o,r),o.forEach((function(c){c.addEventListener("input",(function(){!function(t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?e(t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input-error"),o.textContent=n,o.classList.add("popup__input-error_active")}(t,n,n.validationMessage)}(n,c),t(o,r)}))}))}(n)})),o=l,r=Array.from(o.querySelectorAll(".popup__input")),c=o.querySelector(".popup__button"),r.forEach((function(t){e(o,t)})),t(r,c),document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__image");t.textContent=e.name,n.textContent=e.about,o.style.backgroundImage="url(".concat(e.avatar,")")}(e)})).catch((function(e){console.error("Ошибка при получении данных профиля:",e)})),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return Array.isArray(e)?e:Promise.reject("Данные не являются массивом")})).then((function(e){I(e)})).catch((function(e){console.error("Ошибка при получении карточек:",e)}))})),I()})();